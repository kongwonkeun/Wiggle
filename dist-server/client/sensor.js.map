{"version":3,"sources":["../../src/client/sensor.js"],"names":["G_sensor","G_logger","Sensor","host","socket","buffer","data","count","speed","dir","prototype","connect","document","getElementById","WebSocket","innerHTML","readyState","onopen","onmessage","msg","buf","String","str","split","length","d","isNaN","G_log","window","W_f","W_speed","W_dir","onclose","close","e","module","exports"],"mappings":";;AAAA;AACA,IAAIA,QAAJ;AACA,IAAIC,QAAJ;;AAEA,SAASC,MAAT,GACA;AACI,OAAKC,IAAL,GAAY,6CAAZ;AACA,OAAKC,MAAL;AACA,OAAKC,MAAL,GAAc,CAAd;AACA,OAAKC,IAAL,GAAY,CAAZ;AACA,OAAKC,KAAL,GAAa,CAAb;AACA,OAAKC,KAAL,GAAa,CAAb;AACA,OAAKC,GAAL,GAAW,CAAX;AACH;;AAAA;AAEDP,MAAM,CAACQ,SAAP,GACA;AACIC,EAAAA,OAAO,EAAE,mBAAY;AAEjBX,IAAAA,QAAQ,GAAG,IAAX;AACAC,IAAAA,QAAQ,GAAGW,QAAQ,CAACC,cAAT,CAAwB,YAAxB,CAAX;;AAEA,QAAI;AACA,WAAKT,MAAL,GAAc,IAAIU,SAAJ,CAAc,KAAKX,IAAnB,CAAd;AACAF,MAAAA,QAAQ,CAACc,SAAT,GAAqB,kBAAkBf,QAAQ,CAACI,MAAT,CAAgBY,UAAlC,GAA+C,OAApE;;AAEA,WAAKZ,MAAL,CAAYa,MAAZ,GAAqB,YAAY;AAC7BhB,QAAAA,QAAQ,CAACc,SAAT,GAAqB,mBAAmBf,QAAQ,CAACI,MAAT,CAAgBY,UAAnC,GAAgD,OAArE;AACH,OAFD;;AAIA,WAAKZ,MAAL,CAAYc,SAAZ,GAAwB,UAAUC,GAAV,EAAe;AACnC,YAAIC,GAAG,GAAG,IAAIC,MAAJ,CAAWF,GAAG,CAACb,IAAf,CAAV;AACA,YAAIgB,GAAG,GAAGF,GAAG,CAACG,KAAJ,CAAU,GAAV,CAAV;;AACA,YAAID,GAAG,CAAC,CAAD,CAAH,CAAOE,MAAP,IAAiB,CAArB,EAAwB;AACpB;AACH;;AACD,YAAIC,CAAC,GAAGH,GAAG,CAAC,CAAD,CAAH,CAAOC,KAAP,CAAa,GAAb,CAAR;;AACA,YAAIG,KAAK,CAACD,CAAC,CAAC,CAAD,CAAF,CAAL,IAAeC,KAAK,CAACD,CAAC,CAAC,CAAD,CAAF,CAAxB,EAAgC;AAC5B;AACH;;AACDzB,QAAAA,QAAQ,CAACQ,KAAT,GAAiBiB,CAAC,CAAC,CAAD,CAAlB;AACAzB,QAAAA,QAAQ,CAACS,GAAT,GAAegB,CAAC,CAAC,CAAD,CAAhB;AACAzB,QAAAA,QAAQ,CAACO,KAAT,IAAkB,CAAlB;AAEAoB,QAAAA,KAAK,CAACZ,SAAN,GAAmB,UAAUf,QAAQ,CAACO,KAAnB,GAA2B,OAA9C;AACAoB,QAAAA,KAAK,CAACZ,SAAN,IAAmB,YAAYf,QAAQ,CAACQ,KAArB,GAA6B,OAAhD;AACAmB,QAAAA,KAAK,CAACZ,SAAN,IAAmB,UAAUf,QAAQ,CAACS,GAAnB,GAAyB,OAA5C;AACAkB,QAAAA,KAAK,CAACZ,SAAN,IAAmB,QAAQa,MAAM,CAACC,GAAf,GAAqB,OAAxC;AAEAD,QAAAA,MAAM,CAACE,OAAP,GAAiB9B,QAAQ,CAACQ,KAA1B;AACAoB,QAAAA,MAAM,CAACG,KAAP,GAAe,KAAK/B,QAAQ,CAACS,GAA7B,CApBmC,CAoBD;AACrC,OArBD;;AAuBA,WAAKL,MAAL,CAAY4B,OAAZ,GAAsB,YAAY;AAC9B/B,QAAAA,QAAQ,CAACc,SAAT,GAAqB,oBAAoBf,QAAQ,CAACI,MAAT,CAAgBY,UAApC,GAAiD,OAAtE;AACA,aAAKZ,MAAL,CAAY6B,KAAZ;AACH,OAHD;AAIH,KAnCD,CAoCA,OAAOC,CAAP,EAAU;AACNjC,MAAAA,QAAQ,CAACc,SAAT,GAAqB,oBAAoBmB,CAApB,GAAwB,OAA7C;AACH;AACJ;AA7CL,CADA;AAkDAC,MAAM,CAACC,OAAP,GAAiBlC,MAAjB,C,CACA","sourcesContent":["//\r\nlet G_sensor;\r\nlet G_logger;\r\n\r\nfunction Sensor()\r\n{\r\n    this.host = \"ws://localhost:5331/write_anything_here.php\";\r\n    this.socket;\r\n    this.buffer = 0;\r\n    this.data = 0;\r\n    this.count = 0;\r\n    this.speed = 0;\r\n    this.dir = 0;\r\n};\r\n\r\nSensor.prototype =\r\n{\r\n    connect: function () {\r\n\r\n        G_sensor = this;\r\n        G_logger = document.getElementById(\"sensor-log\");\r\n\r\n        try {\r\n            this.socket = new WebSocket(this.host);\r\n            G_logger.innerHTML = \"socket new = \" + G_sensor.socket.readyState + \"<br/>\";\r\n\r\n            this.socket.onopen = function () {\r\n                G_logger.innerHTML = \"socket open = \" + G_sensor.socket.readyState + \"<br/>\";\r\n            }\r\n\r\n            this.socket.onmessage = function (msg) {\r\n                var buf = new String(msg.data);\r\n                var str = buf.split('V');\r\n                if (str[0].length != 9) {\r\n                    return;\r\n                }\r\n                var d = str[0].split('D');\r\n                if (isNaN(d[0]) || isNaN(d[1])) {\r\n                    return;\r\n                }\r\n                G_sensor.speed = d[0];\r\n                G_sensor.dir = d[1];\r\n                G_sensor.count += 1;\r\n\r\n                G_log.innerHTML  = \"cnt: \" + G_sensor.count + \"<br/>\";\r\n                G_log.innerHTML += \"speed: \" + G_sensor.speed + \"<br/>\";\r\n                G_log.innerHTML += \"dir: \" + G_sensor.dir + \"<br/>\";\r\n                G_log.innerHTML += \"f: \" + window.W_f + \"<br/>\";\r\n\r\n                window.W_speed = G_sensor.speed;\r\n                window.W_dir = 14 - G_sensor.dir; // 14 is the center of dir range (-: left, 0: center, +: right)\r\n            }\r\n\r\n            this.socket.onclose = function () {\r\n                G_logger.innerHTML = \"socket close = \" + G_sensor.socket.readyState + \"<br/>\";\r\n                this.socket.close();\r\n            }\r\n        } \r\n        catch (e) {\r\n            G_logger.innerHTML = \"socket error = \" + e + \"<br/>\";\r\n        }\r\n    },\r\n\r\n};\r\n\r\nmodule.exports = Sensor;\r\n//"],"file":"sensor.js"}